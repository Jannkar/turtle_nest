name: Turtle Nest CI pipeline
on: [pull_request]

jobs:
  build-humble:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build Docker Image
        run: docker compose -f docker/docker-compose.yaml build

  test-humble:
    runs-on: ubuntu-latest
    needs: build-humble
    steps:
      - uses: actions/checkout@v4
      - name: Test Humble
        run: docker compose -f docker/docker-compose.yaml run --build test

  build-test-iron:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Test Iron
        run: docker compose -f docker/docker-compose.yaml run --build test-iron

  build-test-jazzy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Test Jazzy
        run: docker compose -f docker/docker-compose.yaml run --build test-jazzy

  build-test-rolling:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Test Rolling
        run: docker compose -f docker/docker-compose.yaml run --build test-rolling

  colcon-test-rolling:
    runs-on: ubuntu-latest
    needs: build-test-rolling
    steps:
      - uses: actions/checkout@v4
      - name: Run Colcon Test Rolling
        run: docker compose -f docker/docker-compose.yaml run --build colcon-test-rolling

  colcon-test-humble:
    runs-on: ubuntu-latest
    needs: build-humble
    steps:
      - uses: actions/checkout@v4
      - name: Run Colcon Test Humble
        run: docker compose -f docker/docker-compose.yaml run --build colcon-test-humble
